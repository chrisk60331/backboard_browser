{% extends "base.html" %}

{% block title %}Backboard Browser{% endblock %}

{% block content %}
<div class="px-4 py-8 sm:px-0">
    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
        <!-- Assistants Card -->
        <a href="/assistants" class="group block">
            <div class="relative bg-white dark:bg-gray-800 overflow-hidden rounded-2xl shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 hover:shadow-xl hover:ring-blue-300 dark:hover:ring-blue-600 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-blue-600/10 dark:from-blue-500/10 dark:to-blue-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div class="relative p-8">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-blue-100 dark:bg-blue-900/50 rounded-xl group-hover:bg-blue-200 dark:group-hover:bg-blue-800/60 transition-colors duration-300">
                            <svg class="h-10 w-10 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <div class="ml-6 flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">Assistants</h3>
                            <div class="mt-2 flex items-baseline">
                                <div class="text-3xl font-bold text-gray-900 dark:text-white hidden" id="assistantsCount">-</div>
                                <div id="assistantsSpinner" class="animate-spin rounded-full h-7 w-7 border-2 border-blue-200 dark:border-blue-800 border-t-blue-600 dark:border-t-blue-400"></div>
                            </div>
                        </div>
                        <svg class="h-5 w-5 text-gray-400 group-hover:text-blue-500 dark:group-hover:text-blue-400 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </a>

        <!-- Memory Card -->
        <a href="/memory" class="group block">
            <div class="relative bg-white dark:bg-gray-800 overflow-hidden rounded-2xl shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 hover:shadow-xl hover:ring-green-300 dark:hover:ring-green-600 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="absolute inset-0 bg-gradient-to-br from-green-500/5 to-green-600/10 dark:from-green-500/10 dark:to-green-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div class="relative p-8">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-green-100 dark:bg-green-900/50 rounded-xl group-hover:bg-green-200 dark:group-hover:bg-green-800/60 transition-colors duration-300">
                            <svg class="h-10 w-10 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                            </svg>
                        </div>
                        <div class="ml-6 flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors">Memory</h3>
                            <div class="mt-2 flex items-baseline">
                                <div class="text-3xl font-bold text-gray-900 dark:text-white hidden" id="memoryCount">-</div>
                                <div id="memorySpinner" class="animate-spin rounded-full h-7 w-7 border-2 border-green-200 dark:border-green-800 border-t-green-600 dark:border-t-green-400"></div>
                            </div>
                        </div>
                        <svg class="h-5 w-5 text-gray-400 group-hover:text-green-500 dark:group-hover:text-green-400 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </a>

        <!-- Models Card -->
        <a href="/models" class="group block">
            <div class="relative bg-white dark:bg-gray-800 overflow-hidden rounded-2xl shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 hover:shadow-xl hover:ring-purple-300 dark:hover:ring-purple-600 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-purple-600/10 dark:from-purple-500/10 dark:to-purple-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div class="relative p-8">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-purple-100 dark:bg-purple-900/50 rounded-xl group-hover:bg-purple-200 dark:group-hover:bg-purple-800/60 transition-colors duration-300">
                            <svg class="h-10 w-10 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                        </div>
                        <div class="ml-6 flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors">Models</h3>
                            <div class="mt-2 flex items-baseline space-x-2">
                                <div class="text-3xl font-bold text-gray-900 dark:text-white hidden" id="modelsCount">-</div>
                                <div class="text-sm text-gray-500 dark:text-gray-400 hidden" id="modelsProviders">-</div>
                                <div id="modelsSpinner" class="animate-spin rounded-full h-7 w-7 border-2 border-purple-200 dark:border-purple-800 border-t-purple-600 dark:border-t-purple-400"></div>
                            </div>
                        </div>
                        <svg class="h-5 w-5 text-gray-400 group-hover:text-purple-500 dark:group-hover:text-purple-400 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </a>

        <!-- Documents Card -->
        <a href="/documents" class="group block">
            <div class="relative bg-white dark:bg-gray-800 overflow-hidden rounded-2xl shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 hover:shadow-xl hover:ring-amber-300 dark:hover:ring-amber-600 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="absolute inset-0 bg-gradient-to-br from-amber-500/5 to-amber-600/10 dark:from-amber-500/10 dark:to-amber-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div class="relative p-8">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-amber-100 dark:bg-amber-900/50 rounded-xl group-hover:bg-amber-200 dark:group-hover:bg-amber-800/60 transition-colors duration-300">
                            <svg class="h-10 w-10 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <div class="ml-6 flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white group-hover:text-amber-600 dark:group-hover:text-amber-400 transition-colors">Documents</h3>
                            <div class="mt-2 flex items-baseline">
                                <div class="text-3xl font-bold text-gray-900 dark:text-white hidden" id="documentsCount">-</div>
                                <div id="documentsSpinner" class="animate-spin rounded-full h-7 w-7 border-2 border-amber-200 dark:border-amber-800 border-t-amber-600 dark:border-t-amber-400"></div>
                            </div>
                        </div>
                        <svg class="h-5 w-5 text-gray-400 group-hover:text-amber-500 dark:group-hover:text-amber-400 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </a>

        <!-- Threads Card -->
        <a href="/threads" class="group block">
            <div class="relative bg-white dark:bg-gray-800 overflow-hidden rounded-2xl shadow-sm ring-1 ring-gray-200 dark:ring-gray-700 hover:shadow-xl hover:ring-rose-300 dark:hover:ring-rose-600 transition-all duration-300 cursor-pointer transform hover:-translate-y-1">
                <div class="absolute inset-0 bg-gradient-to-br from-rose-500/5 to-rose-600/10 dark:from-rose-500/10 dark:to-rose-600/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                <div class="relative p-8">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 p-3 bg-rose-100 dark:bg-rose-900/50 rounded-xl group-hover:bg-rose-200 dark:group-hover:bg-rose-800/60 transition-colors duration-300">
                            <svg class="h-10 w-10 text-rose-600 dark:text-rose-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                            </svg>
                        </div>
                        <div class="ml-6 flex-1">
                            <h3 class="text-lg font-semibold text-gray-900 dark:text-white group-hover:text-rose-600 dark:group-hover:text-rose-400 transition-colors">Threads</h3>
                            <div class="mt-2 flex items-baseline">
                                <div class="text-3xl font-bold text-gray-900 dark:text-white hidden" id="threadsCount">-</div>
                                <div id="threadsSpinner" class="animate-spin rounded-full h-7 w-7 border-2 border-rose-200 dark:border-rose-800 border-t-rose-600 dark:border-t-rose-400"></div>
                            </div>
                        </div>
                        <svg class="h-5 w-5 text-gray-400 group-hover:text-rose-500 dark:group-hover:text-rose-400 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>

<script>
function hideSpinner(spinnerId) {
    const spinner = document.getElementById(spinnerId);
    if (spinner) spinner.classList.add('hidden');
}

function showCount(countId, value) {
    const countEl = document.getElementById(countId);
    if (countEl) {
        countEl.textContent = value;
        countEl.classList.remove('hidden');
    }
}

async function loadCounts() {
    try {
        // Load all counts from cache endpoints in parallel
        const [assistantsRes, memoryRes, modelsRes, documentsRes, threadsRes] = await Promise.all([
            fetch('/api/cache/assistants-count').catch(() => ({ok: false})),
            fetch('/api/cache/memory-count').catch(() => ({ok: false})),
            fetch('/api/cache/models-count').catch(() => ({ok: false})),
            fetch('/api/cache/documents-count').catch(() => ({ok: false})),
            fetch('/api/cache/threads-count').catch(() => ({ok: false}))
        ]);

        // Assistants count
        if (assistantsRes.ok) {
            const data = await assistantsRes.json();
            hideSpinner('assistantsSpinner');
            showCount('assistantsCount', data.count || '0');
        } else {
            hideSpinner('assistantsSpinner');
            showCount('assistantsCount', '-');
        }

        // Memory count
        if (memoryRes.ok) {
            const data = await memoryRes.json();
            hideSpinner('memorySpinner');
            showCount('memoryCount', data.count || '0');
        } else {
            hideSpinner('memorySpinner');
            showCount('memoryCount', '-');
        }

        // Models count
        if (modelsRes.ok) {
            const data = await modelsRes.json();
            hideSpinner('modelsSpinner');
            showCount('modelsCount', data.count || '0');
            
            // Show providers count
            if (data.providers > 0) {
                const providersEl = document.getElementById('modelsProviders');
                if (providersEl) {
                    providersEl.textContent = `${data.providers} provider${data.providers !== 1 ? 's' : ''}`;
                    providersEl.classList.remove('hidden');
                }
            }
        } else {
            hideSpinner('modelsSpinner');
            showCount('modelsCount', '-');
        }

        // Documents count
        if (documentsRes.ok) {
            const data = await documentsRes.json();
            hideSpinner('documentsSpinner');
            showCount('documentsCount', data.count || '0');
        } else {
            hideSpinner('documentsSpinner');
            showCount('documentsCount', '-');
        }

        // Threads count
        if (threadsRes.ok) {
            const data = await threadsRes.json();
            hideSpinner('threadsSpinner');
            showCount('threadsCount', data.count || '0');
        } else {
            hideSpinner('threadsSpinner');
            showCount('threadsCount', '-');
        }
    } catch (error) {
        console.error('Error loading counts:', error);
        // Hide all spinners on error
        ['assistantsSpinner', 'memorySpinner', 'modelsSpinner', 'documentsSpinner', 'threadsSpinner'].forEach(hideSpinner);
    }
}

loadCounts();
</script>
{% endblock %}
